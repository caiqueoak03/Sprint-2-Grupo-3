<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Soy Venture</title>
		<link rel="stylesheet" href="../styles/cadastro.css" />
		<link rel="shortcut icon" href="../images/logo.png" type="image/x-icon" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400&family=Roboto:ital,wght@0,400;0,700;1,700&display=swap"
			rel="stylesheet"
		/>
		<script
			src="https://kit.fontawesome.com/8c4cdd8d42.js"
			crossorigin="anonymous"
		></script>
		<script src="../js/funcoes.js"></script>
		<script src="//code.jivosite.com/widget/pmhF4yYdug" async></script>
	</head>

	<body>
		<!-- HEADER -->
		<div class="header">
			<a href="../index.html#" class="logo">
				<img src="../images/logo.png" alt="" class="logo-img" />
				<h1 class="nome-empresa">Soy Venture</h1>
			</a>

			<div class="main-nav">
				<ul>
					<li><a href="../index.html#visão-valores">Sobre</a></li>
					<li><a href="../index.html#feature-cards-container">Serviços</a></li>
					<li><a href="../index.html#contato-card">Fale Conosco</a></li>
					<li><a href="calculadora.html">Calculadora</a></li>
				</ul>
			</div>

			<div class="login-nav">
				<ul>
					<li><a href="cadastro.html">Cadastrar</a></li>
					<li><a href="login.html">Entrar</a></li>
				</ul>
			</div>
		</div>

		<!-- CADASTRO -->
		<div class="cadastro">
			<div class="container">
				<div class="box">
					<div class="box_container">
						<div class="card_cadastro2">
							<ul>
								<h2>Cadastro</h2>
								<li>
									Nome:<br /><input
										placeholder="Nome"
										type="text"
										id="in_nome"
										value="John"
									/>
								</li>
								<li>
									Empresa:<br /><input
										placeholder="Nome da empresa"
										type="text"
										value="teste"
										id="in_nomeEmpresa"
									/>
								</li>
								<li>
									Telefone Fixo: <br /><input
										id="in_telFixo"
										placeholder="(00)0000-0000"
										value="1159211122"
										type="text"
									/>
								</li>
								<li>
									Senha:<br /><input
										id="in_senha"
										placeholder="Inserir Senha"
										value="123"
										type="password"
									/>
								</li>
								<li>
									Cnpj:<br /><input
										id="in_cnpj"
										placeholder="Cnpj"
										value="01234567891234"
										type="text"
									/>
								</li>
							</ul>

							<div class="li_card">
								<ul>
									<li>
										Sobrenome:<br /><input
											placeholder="Sobrenome"
											type="text"
											value="Doe"
											id="in_sobrenome"
										/>
									</li>
									<li>
										E-mail:<br /><input
											id="in_email"
											placeholder="E-mail"
											value="teste@gmail.com"
											type="text"
										/>
									</li>
									<li>
										Telefone Celular: <br /><input
											id="in_telCelular"
											placeholder="(00)00000-0000"
											value="11959211122"
											type="text"
										/>
									</li>
									<li>
										Confirmar Senha: <br /><input
											id="in_confirmarSenha"
											placeholder="Repetir Senha"
											value="123"
											type="password"
										/>
									</li>
									<li>
										<button id="criar-conta" onclick="validacao()">
											Criar Conta
										</button>
									</li>
								</ul>
							</div>
						</div>
					</div>

					<div class="feito">
						Ja tem cadastro ?
						<a href="login.html"><span class="destaque">Login</span></a>
					</div>
					<div class="linha"></div>
				</div>
			</div>
		</div>

		<!-- FOOTER -->
		<div class="footer-container">
			<div class="footer-links-container">
				<p>Soy Venture SA | CNPJ: 56.080.425/0001-02</p>

				<ul>
					<li>PORTABILIDADE</li>
					<li>TRABALHE CONOSCO</li>
					<li>SEGURANÇA</li>
					<li>INVESTIDORES</li>
				</ul>
			</div>

			<div class="footer-endereco-container">
				<p class="endereco">
					Cidade de Deus, S/Nº Vila Yara | Osasco | SP | CEP: 06029-900
				</p>

				<p class="copyright">
					Copyright © 2020-2022 Soy Venture Company S.L. Todos os direitos
					reservados.
				</p>
			</div>

			<div class="redes-sociais">
				<p>Siga-nos nas redes sociais!</p>

				<div class="icons-container">
					<i class="fa-brands fa-twitter"></i>
					<i class="fa-brands fa-facebook"></i>
					<i class="fa-brands fa-instagram"></i>
					<i class="fa-brands fa-linkedin"></i>
				</div>
			</div>
		</div>

		<script>
			function validacao() {
				var nome = in_nome.value;
				var sobrenome = in_sobrenome.value;
				var nomeEmpresa = in_nomeEmpresa.value;
				var cnpj = in_cnpj.value;
				var email = in_email.value;
				var telFixo = in_telFixo.value;
				var telCelular = in_telCelular.value;
				var senha = in_senha.value;
				var confirmarSenha = in_confirmarSenha.value;
				var alerta = "";

				if (nome == "") {
					alerta += "*Insira um nome\n";
				}
				if (sobrenome == "") {
					alerta += "*Insira um sobrenome\n";
				}
				if (nomeEmpresa == "") {
					alerta += "*Insira um nome da empresa\n";
				}
				if (cnpj.length != 14) {
					alerta += "*CNPJ deve ter 14 números\n";
				}

				if (email.indexOf("@") == -1 || email.indexOf(".com") == -1) {
					alerta += "*Email deve ter @ e .com\n";
				}

				if (senha != confirmarSenha) {
					alerta += "*As senhas não conferem!!\n";
				}

				if (telFixo.length != 10) {
					alerta += "*Telefone Fixo incorreto\n";
				}

				if (telCelular.length != 11) {
					alerta += "*Telefone Celular incorreto";
				}

				if (alerta != "") {
					alert(alerta);
				} else {
					cadastrarEmpresa();
				}
			}
			function cadastrarEmpresa() {
				var nomeEmpresaVar = in_nomeEmpresa.value;
				var cnpjVar = in_cnpj.value;

				fetch("/usuarios/cadastrarEmpresa", {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify({
						nomeEmpresaServer: nomeEmpresaVar,
						cnpjServer: cnpjVar,
					}),
				})
					.then(function (resposta) {
						console.log("resposta: ", resposta);

						if (resposta.ok) {
							resposta.json().then((json) => {
								console.log(json);
								console.log(JSON.stringify(json));

								var idEmpresa = json[0]["idEmpresa"];
								// var idEmpresa = json[1][0]["idEmpresa"]; //local

								cadastrarCliente(idEmpresa);
							});
						} else {
							alert("Empresa já cadastrada!");
						}
					})
					.catch(function (resposta) {
						console.log(`#ERRO: ${resposta}`);
					});

				return false;
			}

			function cadastrarCliente(idEmpresa) {
				var nomeVar = in_nome.value;
				var sobrenomeVar = in_sobrenome.value;
				var emailVar = in_email.value;
				var telFixoVar = in_telFixo.value;
				var telCelularVar = in_telCelular.value;
				var senhaVar = in_senha.value;
				var idEmpresaVar = idEmpresa;

				fetch("/usuarios/cadastrarFuncionario", {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify({
						nomeServer: nomeVar,
						sobrenomeServer: sobrenomeVar,
						emailServer: emailVar,
						telFixoServer: telFixoVar,
						telCelularServer: telCelularVar,
						senhaServer: senhaVar,
						idEmpresaServer: idEmpresaVar,
						cargoServer: "gerente",
					}),
				})
					.then(function (resposta) {
						console.log("resposta: ", resposta);

						if (resposta.ok) {
							resposta.json().then((json) => {
								console.log(json);
								console.log(JSON.stringify(json));

								window.location = "login.html";
								alert("Empresa cadastrada com sucesso!");
							});
						} else {
							// Caso dê erro no cadastro do cliente, deletar empresa do BD
							fetch("/usuarios/deletarEmpresa", {
								method: "POST",
								headers: {
									"Content-Type": "application/json",
								},
								body: JSON.stringify({
									idEmpresaServer: idEmpresaVar,
								}),
							})
								.then(function (resposta) {
									console.log("resposta: ", resposta);

									if (resposta.ok) {
										console.log("empresa deletada!");
									} else {
										console.log("Erro ao deletar empresa!");
									}
								})
								.catch(function (resposta) {
									console.log(`#ERRO: ${resposta}`);
								});
							alert("email já cadastrado!");
						}
					})
					.catch(function (resposta) {
						console.log(`#ERRO: ${resposta}`);
					});
			}
		</script>
	</body>
</html>
